{% extends 'base.html' %}

{% block title %}{{ product.name }} - Details{% endblock %}

{% block content %}
    <div class="product-detail-container">
        <h1>{{ product.name }}</h1>
        <p class="price">Price: ${{ product.price }}</p>
        <p class="description">{{ product.description }}</p>

        <div class="product-images">
            <h3>Product Images:</h3>
            {# Display featured image first, if available #}
            {% with featured_image=product.get_featured_image %}
                {% if featured_image %}
                    <img src="{{ featured_image.image.url }}" alt="{{ featured_image.alt_text }}" style="max-width: 400px; height: auto; margin-bottom: 10px;">
                    <p><small>{{ featured_image.alt_text }} (Featured)</small></p>
                {% endif %}
            {% endwith %}

            {# Display other images #}
            {% for image in product.images.all %}
                {# Only show if it's not the featured one we just showed, or if no featured image was found #}
                {% if not featured_image or image.pk != featured_image.pk %}
                    <img src="{{ image.image.url }}" alt="{{ image.alt_text }}" style="max-width: 400px; height: auto; margin-bottom: 10px;">
                    <p><small>{{ image.alt_text }}</small></p>
                {% endif %}
            {% empty %}
                {% if not featured_image %}<p>No images available for this product.</p>{% endif %}
            {% endfor %}
        </div>

        <a href="{% url 'products:product_list' %}" class="back-link">Back to Products</a>

        <form action="{% url 'orders:add_to_cart' product.id %}" method="post">
            {% csrf_token %}
            <input type="number" name="quantity" value="1" min="1">
            <button type="submit">Add to Cart</button>
        </form>
    </div>
{% endblock %}